<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style type="text/css">
        * {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

        html {
            -ms-touch-action: none;
        }

        body,
        ul,
        li {
            padding: 0;
            margin: 0;
            border: 0;
        }

        #wrapper {
            height: 50vh;
            margin: 20px;
            background: #ccc;
            overflow: hidden;
        }

        #scroller {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            transform: translateZ(0);
            -webkit-touch-callout: none;
            user-select: none;
            text-size-adjust: none;
            background: pink;
            color: #fff;
        }
    </style>
</head>

<body>
    <div id="wrapper">
        <div id="scroller">
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
            <div>垂直滚动啦</div>
        </div>
    </div>

    <script type="text/javascript">
        class IScroll {
            constructor(wrapper){
                this.wrapper = document.querySelector(wrapper);
                this.scroller = this.wrapper.children[0];

                if(!!(window.PointerEvent || window.MSPointerEvent)){
                    this.wrapper.addEventListener('pointerdown', this, false);
                    window.addEventListener('pointermove', this, false);
                    window.addEventListener('pointerup', this, false);
                }

                if('ontouchstart' in window){
                    this.wrapper.addEventListener('touchstart', this, false);
                    window.addEventListener('touchmove', this, false);
                    window.addEventListener('touchend', this, false);
                }

                this.scroller.addEventListener('transitionend', this.transitionEnd, false);

                this.y = 0;
                this.moving = false;
                this.minY =  - this.scroller.scrollHeight + this.wrapper.clientHeight;
                this.scroller.style['transition-timing-function'] = 'cubic-bezier(0.1, 0.57, 0.1, 1)';
                this.transitionTime(0);
                this.scrollTo(0);
            }

            handleEvent =(e)=>{
                switch(e.type){
                    case 'touchstart':
                    case 'pointerdown':
                        this.start(e);
                        break;
                    case 'touchmove':
                    case 'pointermove':
                        this.move(e);
                        break;
                    case 'touchend':
                    case 'pointerup':
                        this.end(e);
                        break;
                }
            }

            start = (e)=>{

                e.stopPropagation();
                e.preventDefault();

                const point = e.touches ? e.touches[0] : e;

                this.lastPointY = point.pageY;
                this.moving = true;
            }
            move = (e)=>{
                if(!this.moving) return;
                const point = e.touches ? e.touches[0] : e;

                const deltaY = point.pageY - this.lastPointY;
                let newY = this.y + deltaY;
                
                if(newY > 0 || newY < this.minY){ // 拽出边界
                    newY = this.y + deltaY / 3;
                }
                this.scrollTo(newY);

                this.lastPointY = point.pageY;
            }
            end = ()=>{
                this.moving = false;

                if(this.y > 0){
                    this.transitionTime(600);
                    this.scrollTo(0);
                } else if(this.y < this.minY){
                    this.transitionTime(600);
                    this.scrollTo(this.minY);
                }
            }
            transitionEnd = () => {
                this.transitionTime(0);
            }
            scrollTo(y){
                this.scroller.style['transform'] = `translate(0px, ${y}px) translateZ(0px)`;
                this.y = y;
            }
            transitionTime(t){
                this.scroller.style['transition-duration'] = `${t}ms`;
            }
        }
        window.onload = function () {
            new IScroll('#wrapper')
        }
        document.addEventListener('touchmove', function (e) { e.preventDefault(); }, {  // 防止触发浏览器默认事件，下滑刷新之类的
            capture: false,
            passive: false
        });
    </script>
</body>

</html>